<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ShooymCord Receiver</title>
<script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>

<style>
body {
  margin: 0;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  background: linear-gradient(135deg, #1e1f22, #2b2d31);
  font-family: "Segoe UI", sans-serif;
  color: #fff;
}

.card {
  background: #313338;
  padding: 25px;
  width: 420px;
  border-radius: 16px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.4);
  display: flex;
  flex-direction: column;
}

h2 {
  margin: 0 0 5px;
}

.sub {
  font-size: 0.85rem;
  color: #b5bac1;
  margin-bottom: 15px;
}

.status {
  font-size: 0.85rem;
  color: #23a559;
  margin-bottom: 10px;
}

.chat {
  background: #2b2d31;
  flex: 1;
  padding: 12px;
  border-radius: 12px;
  overflow-y: auto;
  font-size: 0.9rem;
}

.msg {
  margin-bottom: 10px;
  padding: 8px 10px;
  background: #383a40;
  border-radius: 8px;
  line-height: 1.3;
}

.user {
  font-weight: 600;
  color: #5865f2;
  margin-bottom: 3px;
  font-size: 0.8rem;
}
</style>
</head>

<body>
<div class="card">
  <h2>Receiver Online</h2>
  <div class="sub">Host ID: <b>ipsharewithshooym</b></div>
  <div class="status" id="status">Starting...</div>
  <div class="chat" id="chat"></div>
</div>

<script>
const statusText = document.getElementById("status");
const chat = document.getElementById("chat");

const peer = new Peer("ipsharewithshooym");
let connections = {};

function addMessage(user, text) {
  const wrap = document.createElement("div");
  wrap.className = "msg";

  const name = document.createElement("div");
  name.className = "user";
  name.textContent = user;

  const body = document.createElement("div");
  body.textContent = text;

  wrap.appendChild(name);
  wrap.appendChild(body);
  chat.appendChild(wrap);
  chat.scrollTop = chat.scrollHeight;
}

peer.on("open", id => {
  statusText.textContent = "Waiting for connections...";
});

peer.on("connection", conn => {
  statusText.textContent = "Device connected";
  connections[conn.peer] = { conn, user: "Unknown", pfp: "" };

  conn.on("data", data => {

    // Identification packet
    if (data.type === "identify") {
      connections[conn.peer].user = data.user;
      connections[conn.peer].pfp = data.pfp;
      addMessage("System", data.user + " joined");
      return;
    }

    // Normal chat packet
    if (data.msg) {
      addMessage(data.user || "User", data.msg);

      // Send confirmation back so sender knows it arrived
      conn.send(data);
    }
  });

  conn.on("close", () => {
    addMessage("System", "Connection closed");
  });

  conn.on("error", err => {
    addMessage("Error", err);
  });
});
</script>
</body>
</html>